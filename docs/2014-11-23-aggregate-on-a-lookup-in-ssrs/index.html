<!DOCTYPE html>
<html lang="en-gb">
    <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.25.1" />
    <title>Aggregate on a Lookup in SSRS</title>
    
    
    
    <meta name="description" content="A description that will appear as a default if front matter does not exist" />
    <meta name="keywords" content='code,hacks,lookup,SSRS,VB' />
    
        <meta name="author" content="Oz" />
    
    
    <link href="" rel="alternate" type="application/rss+xml" title="Locke Data Blog" />
    <link rel="stylesheet" href="http://lockelife.com/blog/css/bootstrap.min.css" />
    <link rel="stylesheet" href="http://lockelife.com/blog/css/highlightjs-themes/androidstudio.css" />
    <link rel="stylesheet" href="http://lockelife.com/blog/css/font-awesome.min.css" />
    <link rel="stylesheet" href="http://lockelife.com/blog/css/lockedata.css" />
    
        
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({
                    google_ad_client: "ca-pub-XXXXXX",
                    enable_page_level_ads: true
                });
            </script>
        
    
</head>

    <body>
        <!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">

    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand page-scroll" href="/blog/#page-top">
          
          <img src="http://lockelife.com/blog/img/LockeDataTextNew.svg" class="img-responsive" alt="">
        </a>
      

    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li class="hidden">
          <a href="/blog/#page-top"></a>
        </li>
        
          <li>
            <a href="http://lockelife.com">Locke Data</a>
          </li>
        
          <li>
            <a href="/blog/blog/">Blog</a>
          </li>
        

        
        
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container-fluid -->
</nav>

        <div id="top" class="container">
            <div class="row" id="content-main">
                <div class="col-md-8">
                    <div class="row">
    <div class="col-md-12 content-card">
        <h1>Aggregate on a Lookup in SSRS</h1>
        
            
            <ul class="list-inline meta">
                <li><i class="fa fa-calendar"></i>November 23, 2014</li>
                <li><i class="fa fa-user"></i>Oz</li>
                
                    
                    <li><i class="fa fa-folder"></i><a href="http://lockelife.com/categories/microsoft-data-platform">Microsoft Data Platform</a></li>
                
            </ul>
        
        
    <ul class="list-inline share" style="margin-top: 15px; margin-left: 0px">
        <li class="facebook-share"><a target="_blank" href="http://www.facebook.com/sharer.php?u=http%3a%2f%2flockelife.com%2fblog%2f2014-11-23-aggregate-on-a-lookup-in-ssrs%2f"><i class="fa fa-facebook fa-lg"></i>Facebook</a></li>
        <li class="googleplus-share"><a target="_blank" href="https://plus.google.com/share?url=http%3a%2f%2flockelife.com%2fblog%2f2014-11-23-aggregate-on-a-lookup-in-ssrs%2f"><i class="fa fa-google-plus fa-lg"></i>Google+</a></li>
        <li class="twitter-share"><a target="_blank" href="https://twitter.com/share?url=http%3a%2f%2flockelife.com%2fblog%2f2014-11-23-aggregate-on-a-lookup-in-ssrs%2f&amp;text=Aggregate%20on%20a%20Lookup%20in%20SSRS"><i class="fa fa-twitter fa-lg"></i>Twitter</a></li>
        <li class="reddit-share"><a target="_blank" href="http://reddit.com/submit?url=http%3a%2f%2flockelife.com%2fblog%2f2014-11-23-aggregate-on-a-lookup-in-ssrs%2f&amp;title=Aggregate%20on%20a%20Lookup%20in%20SSRS"><i class="fa fa-reddit fa-lg"></i>Reddit</a></li>
        <li class="linkedin-share"><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2flockelife.com%2fblog%2f2014-11-23-aggregate-on-a-lookup-in-ssrs%2f"><i class="fa fa-linkedin fa-lg"></i>LinkedIn</a></li>
        <li class="stumbleupon-share"><a target="_blank" href="http://www.stumbleupon.com/submit?url=http%3a%2f%2flockelife.com%2fblog%2f2014-11-23-aggregate-on-a-lookup-in-ssrs%2f&amp;title=Aggregate%20on%20a%20Lookup%20in%20SSRS"><i class="fa fa-stumbleupon fa-lg"></i>StumbleUpon</a></li>
    </ul>


        <h2 id="the-what">The What</h2>

<p>If you need to join multiple datasets inside SSRS, perhaps because of different sources, grains of detail etc, then you often need to aggregate over both datasets.</p>

<p>In SSRS, you can easily perform aggregations over another dataset but it can be tough to do this based on a grouping factor in your main dataset.</p>

<p>A key example of this might be Sales and Purchases &#8211; you want to show both of these by month but they come from two different data sources.</p>

<p>You could build two tables that appear to be just one table but this can be really clunky. Instead, you want just one table with the month, the total sales, and the total purchases in.</p>

<p>Although there&#8217;s no tidy way of doing this built in, you have the power to add your own functions to SSRS using the Code window of the report&#8217;s properties. Provided here is a block of VB script that can be added to your SSRS report to allow you to do those tricky aggregations as if they were just another built in function.</p>

<p>I call it AggLookup.</p>

<p></p>

<h2 id="adding-the-code">Adding the code</h2>

<p>To use this code, it needs to be added to the custom code of the report. To do that:</p>

<ol>
<li>right click in the area behind the report</li>
<li>select Properties</li>
<li>select Code</li>
<li>copy and paste the below into the Code window</li>
<li>hit OK</li>
</ol>

<h2 id="the-code">The Code</h2>

<p>The code is quite long so I have provided it on <a href="https://github.com/OzLocke/SSRSAggLookup">github.com/OzLocke/SSRSAggLookup</a>.</p>

<p>This means you can get it from GitHub, log issues with it, and can even contribute improvements to it. If you&#8217;ve not used GitHub before, check out the handy <a href="https://guides.github.com/">Getting Started guides</a>.</p>

<h2 id="how-to-use-it">How to use it</h2>

<p>All you need to do to use this code is enter the following expression into a cell:</p>

<p><code>=code.AggLookup([aggregation], LookupSet([localValue], [matchValue], [returnValue], [dataset]))</code></p>

<p>The aggregation should be entered in lower case, as a string, and the available aggregations are <code>count</code>, <code>sum</code>, <code>min</code>, <code>max</code> and <code>avg</code>.</p>

<p>So this would allow you to do build a table for your Sales data grouped by month and then sum the Purchase data by that month also, so the figures are unified into one table.</p>

<p>This also has the advantage of enabling dynamic aggregations via a parameter containing the aggregation names for both primary and secondary data sets which is easier than writing <code>SWITCH</code> statements that swap functions.&nbsp;This means you can have one report that shows the counts or sums of values depending on the user&#8217;s preference without having to maintain multiple reports or a much bigger report.</p>
        
    <ul class="list-inline tags" style="margin-top: 15px; margin-left: 0px">
        
            <li style=""><a href="http://lockelife.com/tags/code">code</a></li>
        
            <li style=""><a href="http://lockelife.com/tags/hacks">hacks</a></li>
        
            <li style=""><a href="http://lockelife.com/tags/lookup">lookup</a></li>
        
            <li style=""><a href="http://lockelife.com/tags/ssrs">SSRS</a></li>
        
            <li style=""><a href="http://lockelife.com/tags/vb">VB</a></li>
        
    </ul>


    </div>
</div>

                    
    
        <div class="row">
            <div class="col-md-12 content-card">
                <div id="disqus_thread"></div>
                <script>
                    (function() {
                        if (window.location.hostname == "localhost") {
                            document.write("Disqus comments are unavailable while serving on localhost or 127.0.0.1");
                            return;
                        }
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        var disqus_shortname = 'shortname';
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </div>
    


                </div>
         <div class="col-md-4">                    
	
<div class="row">
    <div class="col-md-11 col-md-offset-1 card">
        <h5></h5>
        <p></p>
		<img class="avatar" src="img/ChibiSteph.svg"></img>
    </div>
</div>

    <div class="row">
    <div class="col-md-11 col-md-offset-1 card">
        <h5>Search</h5>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
            <div class="input-group">
                <input class="form-control" type="search" name="q" />
                <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-search"></span></button>
                </span>
            </div>
            <input type="hidden" name="q" value="site:">
        </form>
    </div>
</div>

    

</div>
            </div>
        </div>
        <!-- Footer section -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <span class="copyright">
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
        </span>
      </div>
      <div class="col-md-4">
        <ul class="list-inline social-buttons">
          
            <li>
              <a href="/blog/#"><i class='fa fa-twitter'></i></a>
            </li>
          
            <li>
              <a href="/blog/#"><i class='fa fa-facebook'></i></a>
            </li>
          
            <li>
              <a href="/blog/#"><i class='fa fa-linkedin'></i></a>
            </li>
          
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="list-inline quicklinks">
          
            <li>
              <a href="http://lockelife.com/#company">Legalise and stuff</a>
            </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>

        <div id="back-to-top" class="hidden">
    <a href="#top" class="well well-sm" onclick="$('html,body').animate({scrollTop:0},'slow');return false;">
        <i class="glyphicon glyphicon-chevron-up"></i> Back to Top
    </a>
</div>
<script src="http://lockelife.com/blog/js/jquery.min.js"></script>
<script src="http://lockelife.com/blog/js/bootstrap.min.js"></script>
<script src="http://lockelife.com/blog/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
    if(($(window).height() + 100) < $(document).height()) {
        $('#back-to-top').removeClass('hidden').affix({
            offset: {
                top: 100
            }
        });
    }
</script>

    
        <script>
            
            [].forEach.call(document.querySelectorAll('.adsbygoogle'), function() {
                (adsbygoogle = window.adsbygoogle || []).push({});
            });
        </script>
    


    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-XXXXX-YY', 'auto');
        ga('send', 'pageview');
    </script>




    </body>
</html>
