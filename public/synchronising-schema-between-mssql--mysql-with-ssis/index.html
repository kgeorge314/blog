<!DOCTYPE html>
<html lang="en-gb">
    <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.31.1" />
    <title>Synchronising schema between MSSQL &amp; MySQL with SSIS</title>
    
    
    
	  <meta property="og:title" content="Synchronising schema between MSSQL &amp; MySQL with SSIS" />
<meta property="og:description" content="The problem:

A system we need to report on that is form based.  Whenever there is a new form, there is a new table, and whenever there is a new or amended* field on the form, there is a new column in the table.  Maintaining the imports of this data into a staging environment would require a lot of code and time to build manually from scratch.

What is required is something that goes through the two schema for all relevant objects and updates our staging area’s schema accordingly.

Points for consideration:


Due to the level of change in source system, all loads are dynamically generated SQL
Loads run from a data dictionary table, which needs to be updated when we update the schema
Loads occur daily


" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itsalocke.com/blog/synchronising-schema-between-mssql--mysql-with-ssis/" />



<meta property="article:published_time" content="2013-05-29T16:25:47&#43;00:00"/>

<meta property="article:modified_time" content="2013-05-29T16:25:47&#43;00:00"/>













<meta itemprop="name" content="Synchronising schema between MSSQL &amp; MySQL with SSIS">
<meta itemprop="description" content="The problem:

A system we need to report on that is form based.  Whenever there is a new form, there is a new table, and whenever there is a new or amended* field on the form, there is a new column in the table.  Maintaining the imports of this data into a staging environment would require a lot of code and time to build manually from scratch.

What is required is something that goes through the two schema for all relevant objects and updates our staging area’s schema accordingly.

Points for consideration:


Due to the level of change in source system, all loads are dynamically generated SQL
Loads run from a data dictionary table, which needs to be updated when we update the schema
Loads occur daily


">


<meta itemprop="datePublished" content="2013-05-29T16:25:47&#43;00:00" />
<meta itemprop="dateModified" content="2013-05-29T16:25:47&#43;00:00" />
<meta itemprop="wordCount" content="443">



<meta itemprop="keywords" content="datawarehouse,mssql,mysql,ssis," />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Synchronising schema between MSSQL &amp; MySQL with SSIS"/>
<meta name="twitter:description" content="The problem:

A system we need to report on that is form based.  Whenever there is a new form, there is a new table, and whenever there is a new or amended* field on the form, there is a new column in the table.  Maintaining the imports of this data into a staging environment would require a lot of code and time to build manually from scratch.

What is required is something that goes through the two schema for all relevant objects and updates our staging area’s schema accordingly.

Points for consideration:


Due to the level of change in source system, all loads are dynamically generated SQL
Loads run from a data dictionary table, which needs to be updated when we update the schema
Loads occur daily


"/>
<meta name="twitter:site" content="@lockedata"/>

    <meta name="description" content="Locke Data helps organisations get started with data science. Grow your skills with our blog posts." />
    <meta name="keywords" content='datawarehouse,mssql,mysql,ssis' />
    
        <meta name="author" content="Steph" />
    
    
	
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/highlightjs-themes/androidstudio.css" />
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/lockedata.css" />
    
        
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({
                    google_ad_client: "ca-pub-XXXXXX",
                    enable_page_level_ads: true
                });
            </script>
        
    
</head>

    <body>
        <!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">

    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand page-scroll" href="/blog/#page-top">
          
          <img src="https://itsalocke.com/blog/img/LockeDataTextNew.svg" class="img-responsive" alt="">
        </a>
      

    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li class="hidden">
          <a href="/blog/#page-top"></a>
        </li>
        
          <li>
            <a href="https://itsalocke.com">Locke Data</a>
          </li>
        
          <li>
            <a href="https://itsalocke.com/blog/">Blog</a>
          </li>
        

        
        
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container-fluid -->
</nav>

        <div id="top" class="container">
            <div class="row" id="content-main">
                    <div class="row">
    <div class="col-md-12 content-card">
        <h1>Synchronising schema between MSSQL &amp; MySQL with SSIS</h1>
        
            
            <ul class="list-inline meta">
                <li><i class="fa fa-calendar"></i>May 29, 2013</li>
                <li><i class="fa fa-user"></i>Steph</li>
                
                    
                    <li><i class="fa fa-folder"></i><a href="https://itsalocke.com/categories/microsoft-data-platform">Microsoft Data Platform</a></li>
                
            </ul>
        
        
    <ul class="list-inline tags" style="margin-top: 15px; margin-left: 0px">
        
            <li style=""><a href="https://itsalocke.com/tags/datawarehouse">datawarehouse</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/mssql">mssql</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/mysql">mysql</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/ssis">ssis</a></li>
        
    </ul>


        <p>The problem:</p>

<p>A system we need to report on that is form based.  Whenever there is a new form, there is a new table, and whenever there is a new or amended* field on the form, there is a new column in the table.  Maintaining the imports of this data into a staging environment would require a lot of code and time to build manually from scratch.</p>

<p>What is required is something that goes through the two schema for all relevant objects and updates our staging area’s schema accordingly.</p>

<p>Points for consideration:</p>

<ul>
<li>Due to the level of change in source system, all loads are dynamically generated SQL</li>
<li>Loads run from a data dictionary table, which needs to be updated when we update the schema</li>
<li>Loads occur daily</li>
</ul>

<p></p>

<h2 id="group-concat">Group_concat</h2>

<p>On top of existing mysql requirements, we need group_concat – a brilliant function and very useful in this situation.  It is set so that tables with lots of measures can have all the names collapsed into one string without truncation</p>

<p><a href="../img/schemasync-pic1_zgmzho.jpg"><img class="alignnone size-medium wp-image-8491" src="../img/schemasync-pic1_zgmzho_rfaglu.jpg" alt="schemasync - pic1" width="500" height="347" /></a></p>

<h2 id="second-up-list-of-key-objects">Second up: list of key objects</h2>

<p><a href="../img/schemasync-pic2_iwfjp1.jpg"><img class="alignnone size-medium wp-image-8511" src="../img/schemasync-pic2_iwfjp1_mlkfqo.jpg" alt="schemasync - pic2" width="500" height="423" /></a></p>

<p><a href="../img/schemasync-pic3_erycfu.jpg"><img class="alignnone size-medium wp-image-8521" src="../img/schemasync-pic3_erycfu_qwnsb9.jpg" alt="schemasync - pic3" width="500" height="143" /></a></p>

<h2 id="enumerate-through-key-objects">Enumerate through key objects</h2>

<p><a href="../img/schemasync-pic4_suuixn_jro3e9.png"><img class="alignnone size-full wp-image-8531" src="../img/schemasync-pic4_suuixn_jro3e9.png" alt="schemasync - pic4" width="238" height="337" /></a></p>

<p><a href="../img/schemasync-pic5_nmekei.jpg"><img class="alignnone size-medium wp-image-8541" src="../img/schemasync-pic5_nmekei_bwqno9.jpg" alt="schemasync - pic5" width="500" height="419" /></a></p>

<p>&nbsp;</p>

<h2 id="drop-existing-table">Drop existing table</h2>

<p>Because it’s easier to drop and recreate a table rather than alter it, I proceed to drop and recreate the table &#8211; don&#8217;t do this on tables you report directly from! <a href="../img/schemasync-pic6_oeekzw.jpg"><img class="alignnone size-medium wp-image-8551" src="../img/schemasync-pic6_oeekzw_tk35t6.jpg" alt="schemasync - pic6" width="500" height="424" /></a></p>

<p>Use a variable to make sql dynamic</p>

<p><a href="../img/schemasync-pic7_nd0bpp.jpg"><img class="alignnone size-medium wp-image-8561" src="../img/schemasync-pic7_nd0bpp_tzshhe.jpg" alt="schemasync - pic7" width="500" height="424" /></a></p>

<p><strong>DropTableSQL</strong> &lt;&#8211; &#8220;drop table if exists worksmart_&#8221;+ @[User::TableToCheck]</p>

<h2 id="data-flow-task-update-data-dictionary">Data flow task: update data dictionary</h2>

<p><a href="../img/schemasync-pic8_ym6xzk.png"><img class="alignnone size-medium wp-image-8571" src="../img/schemasync-pic8_ym6xzk_ccivzs.png" alt="schemasync - pic8" width="500" height="473" /></a></p>

<p>In Source tasks, dummy sql is required:</p>

<pre>SELECT 
ltrim(lower(COLUMN_NAME)) as systemfield, 
DATA_TYPE
FROM    INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME ='TableToCheck' 
AND data_type&lt;&gt;'image' 
AND COLUMN_NAME NOT IN ('function','pref_name') 
ORDER BY replace(column_name,'_','')</pre>

<p>You will then need to add an expression on the data flow task for the sql to actually pull from a variable:</p>

<p><a href="../img/schemasync-pic9_r6jtul.jpg"><img class="alignnone size-medium wp-image-8581" src="../img/schemasync-pic9_r6jtul_od3ib0.jpg" alt="schemasync - pic9" width="500" height="486" /></a></p>

<p><strong>WorksmartColumnDataSQL</strong> &lt;-</p>

<pre>"SELECT 
ltrim(lower(COLUMN_NAME)) as systemfield, 
DATA_TYPE
FROM    INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME ='TableToCheck' 
AND data_type&lt;&gt;'image' 
AND COLUMN_NAME NOT IN ('function','pref_name') 
ORDER BY replace(column_name,'_','')"</pre>

<h3 id="left-join-data-to-identify-what-is-already-present">Left join data to identify what is already present</h3>

<p><a href="../img/schemasync-pic10_ap6uyr.jpg"><img class="alignnone size-medium wp-image-8591" src="../img/schemasync-pic10_ap6uyr_zaeeul.jpg" alt="schemasync - pic10" width="500" height="470" /></a></p>

<h3 id="only-get-new-entries">Only get new entries</h3>

<p><a href="../img/schemasync-pic11_vfhh2a.jpg"><img class="alignnone size-medium wp-image-8601" src="../img/schemasync-pic11_vfhh2a_mqeqbr.jpg" alt="schemasync - pic11" width="500" height="259" /></a></p>

<p>Nb – At this point I go onto add some more details but this is a similar step to above so I won’t cover it</p>

<h3 id="add-extra-columns-as-required">Add extra columns as required</h3>

<p><a href="../img/schemasync-pic12_wazpuq.jpg"><img class="alignnone size-medium wp-image-8611" src="../img/schemasync-pic12_wazpuq_pohswy.jpg" alt="schemasync - pic12" width="500" height="413" /></a></p>

<h3 id="insert-into-destination">Insert into destination</h3>

<h2 id="create-table-based-on-new-metadata">Create table based on new metadata</h2>

<p>Same mechanism as dropping a table – a sql task, and a variable</p>

<p><strong>TableCreationSQL</strong> &lt;-</p>

<pre>"select 
concat(' create table ', table,' (',
GROUP_CONCAT(concat(Field, ' ', fieldtype,' comment ''',coalesce(fielddescription,''),'''')),
coalesce(concat(', primary key(',(
             select group_concat(field) 
             from _data_dictionary d2 
             where d2. table=d. able 
             and d2.Is_PrimaryKey='y' 
             group by table),')'),''), ') 
ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci') 
FROM _data_dictionary d 
where systemtable='"+ @[User::TableToCheck] +
"' group by table"</pre>

<p>The Result Set is then passed to the next variable to be executed</p>

<h2 id="perform-table-creation">Perform table creation</h2>

<p>As above but no mapping, and ActualTableCreationSQL is used</p>

<p><a href="../img/schemasync-pic13_y1qg3h_eaqxfz.jpg"><img class="alignnone size-full wp-image-8501" src="../img/schemasync-pic13_y1qg3h_eaqxfz.jpg" alt="schemasync - pic13" width="624" height="533" /></a></p>
		</div>
		
</div>
    <div class="row">
    <div class="col-md-12 card">
        <h5>Search</h5>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
            <div class="input-group">
                <input class="form-control" type="search" name="q" />
                <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-search"></span></button>
                </span>
            </div>
            <input type="hidden" name="q" value="site:https://itsalocke.com/blog/">
        </form>
    </div>
</div>

<div class="row">
		  <div class="col-md-12 content-card">
        
    <ul class="list-inline share" style="margin-top: 15px; margin-left: 0px">
        <li class="facebook-share"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fitsalocke.com%2fblog%2fsynchronising-schema-between-mssql--mysql-with-ssis%2f"><i class="fa fa-facebook fa-lg"></i>Facebook</a></li>
        <li class="googleplus-share"><a target="_blank" href="https://plus.google.com/share?url=https%3a%2f%2fitsalocke.com%2fblog%2fsynchronising-schema-between-mssql--mysql-with-ssis%2f"><i class="fa fa-google-plus fa-lg"></i>Google+</a></li>
        <li class="twitter-share"><a target="_blank" href="https://twitter.com/share?url=https%3a%2f%2fitsalocke.com%2fblog%2fsynchronising-schema-between-mssql--mysql-with-ssis%2f&amp;text=Synchronising%20schema%20between%20MSSQL%20%26%20MySQL%20with%20SSIS"><i class="fa fa-twitter fa-lg"></i>Twitter</a></li>
        <li class="reddit-share"><a target="_blank" href="http://reddit.com/submit?url=https%3a%2f%2fitsalocke.com%2fblog%2fsynchronising-schema-between-mssql--mysql-with-ssis%2f&amp;title=Synchronising%20schema%20between%20MSSQL%20%26%20MySQL%20with%20SSIS"><i class="fa fa-reddit fa-lg"></i>Reddit</a></li>
        <li class="linkedin-share"><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fitsalocke.com%2fblog%2fsynchronising-schema-between-mssql--mysql-with-ssis%2f"><i class="fa fa-linkedin fa-lg"></i>LinkedIn</a></li>
        <li class="stumbleupon-share"><a target="_blank" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fitsalocke.com%2fblog%2fsynchronising-schema-between-mssql--mysql-with-ssis%2f&amp;title=Synchronising%20schema%20between%20MSSQL%20%26%20MySQL%20with%20SSIS"><i class="fa fa-stumbleupon fa-lg"></i>StumbleUpon</a></li>
    </ul>


    </div>
	</div>

                    
    
        <div class="row">
            <div class="col-md-12 content-card">
                <div id="disqus_thread"></div>
                <script>
                    (function() {
                        if (window.location.hostname == "localhost") {
                            document.write("Disqus comments are unavailable while serving on localhost or 127.0.0.1");
                            return;
                        }
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        var disqus_shortname = 'itsalocke';
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </div>
    


            </div>
        </div>
        <!-- Footer section -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <span class="copyright">
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
        </span>
      </div>
      <div class="col-md-4">
        <ul class="list-inline social-buttons">
          
            <li>
              <a href="https://twitter.com/lockedata"><i class='fa fa-twitter'></i></a>
            </li>
          
            <li>
              <a href="https://facebook.com/lockedata"><i class='fa fa-facebook'></i></a>
            </li>
          
            <li>
              <a href="https://linkedin.com/company/locke-data"><i class='fa fa-linkedin'></i></a>
            </li>
          
            <li>
              <a href="https://github.com/lockedata"><i class='fa fa-github'></i></a>
            </li>
          
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="list-inline quicklinks">
          
            <li>
              <a href="/blog/index.xml">RSS</a>
            </li>
          
            <li>
              <a href="https://itsalocke.com/company/policies">Legalese and stuff</a>
            </li>
          
            <li>
              <a href="https://goo.gl/forms/KQiYR201Fcn4k9Zh2">Bug Bounty</a>
            </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>

        <div id="back-to-top" class="hidden">
    <a href="#top" class="well well-sm" onclick="$('html,body').animate({scrollTop:0},'slow');return false;">
        <i class="glyphicon glyphicon-chevron-up"></i> Back to Top
    </a>
</div>
<script src="https://itsalocke.com/blog/js/jquery.min.js"></script>
<script src="https://itsalocke.com/blog/js/bootstrap.min.js"></script>
<script src="https://itsalocke.com/blog/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
    if(($(window).height() + 100) < $(document).height()) {
        $('#back-to-top').removeClass('hidden').affix({
            offset: {
                top: 100
            }
        });
    }
</script>

    
        <script>
            
            [].forEach.call(document.querySelectorAll('.adsbygoogle'), function() {
                (adsbygoogle = window.adsbygoogle || []).push({});
            });
        </script>
    


    
 
 
 <script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-58415537-1', 'auto');


ga('require', 'eventTracker');
ga('require', 'outboundLinkTracker');
ga('require', 'urlChangeTracker');
ga('require', 'cleanUrlTracker');
ga('require', 'impressionTracker');
ga('require', 'maxScrollTracker');
ga('require', 'pageVisibilityTracker');


ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<script async src="js/autotrack.js"></script>




    </body>
</html>
