<!DOCTYPE html>
<html lang="en-gb">
    <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.30" />
    <title>Improving automatic document production with R</title>
    
    
    
	  <meta property="og:title" content="Improving automatic document production with R" />
<meta property="og:description" content="In this post, I describe the latest iteration of my automatic document production with R. It improves upon the methods used in Rtraining, and previous work on this topic can read by going to the auto deploying R documentation tag.
I keep banging on about this area because reproducible research / analytical document pipelines is an area I&#8217;ve a keen interest in. I see it as a core part of DataOps as it&#8217;s vital for helping us ensure our models and analysis are correct in data science and boosting our productivity." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itsalocke.com/blog/improving-automatic-document-production-with-r/" />



<meta property="article:published_time" content="2017-05-19T08:02:26&#43;00:00"/>

<meta property="article:modified_time" content="2017-05-19T08:02:26&#43;00:00"/>













<meta itemprop="name" content="Improving automatic document production with R">
<meta itemprop="description" content="In this post, I describe the latest iteration of my automatic document production with R. It improves upon the methods used in Rtraining, and previous work on this topic can read by going to the auto deploying R documentation tag.
I keep banging on about this area because reproducible research / analytical document pipelines is an area I&#8217;ve a keen interest in. I see it as a core part of DataOps as it&#8217;s vital for helping us ensure our models and analysis are correct in data science and boosting our productivity.">


<meta itemprop="datePublished" content="2017-05-19T08:02:26&#43;00:00" />
<meta itemprop="dateModified" content="2017-05-19T08:02:26&#43;00:00" />
<meta itemprop="wordCount" content="769">



<meta itemprop="keywords" content="auto deploying r documentation,best practices,continuous integration,presentations,productivity,rmarkdown,travis-ci," />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Improving automatic document production with R"/>
<meta name="twitter:description" content="In this post, I describe the latest iteration of my automatic document production with R. It improves upon the methods used in Rtraining, and previous work on this topic can read by going to the auto deploying R documentation tag.
I keep banging on about this area because reproducible research / analytical document pipelines is an area I&#8217;ve a keen interest in. I see it as a core part of DataOps as it&#8217;s vital for helping us ensure our models and analysis are correct in data science and boosting our productivity."/>
<meta name="twitter:site" content="@lockedata"/>

    <meta name="description" content="Locke Data helps organisations get started with data science. Grow your skills with our blog posts." />
    <meta name="keywords" content='auto deploying r documentation,best practices,continuous integration,presentations,productivity,rmarkdown,travis-ci' />
    
        <meta name="author" content="Steph" />
    
    
	
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/highlightjs-themes/androidstudio.css" />
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/lockedata.css" />
    
        
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({
                    google_ad_client: "ca-pub-XXXXXX",
                    enable_page_level_ads: true
                });
            </script>
        
    
</head>

    <body>
        <!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">

    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand page-scroll" href="/blog/#page-top">
          
          <img src="https://itsalocke.com/blog/img/LockeDataTextNew.svg" class="img-responsive" alt="">
        </a>
      

    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li class="hidden">
          <a href="/blog/#page-top"></a>
        </li>
        
          <li>
            <a href="https://itsalocke.com">Locke Data</a>
          </li>
        
          <li>
            <a href="https://itsalocke.com/blog/">Blog</a>
          </li>
        

        
        
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container-fluid -->
</nav>

        <div id="top" class="container">
            <div class="row" id="content-main">
                    <div class="row">
    <div class="col-md-12 content-card">
        <h1>Improving automatic document production with R</h1>
        
            
            <ul class="list-inline meta">
                <li><i class="fa fa-calendar"></i>May 19, 2017</li>
                <li><i class="fa fa-user"></i>Steph</li>
                
                    
                    <li><i class="fa fa-folder"></i><a href="https://itsalocke.com/categories/data-science">Data Science</a>, <a href="https://itsalocke.com/categories/dataops">DataOps</a>, <a href="https://itsalocke.com/categories/r">R</a></li>
                
            </ul>
        
        
    <ul class="list-inline tags" style="margin-top: 15px; margin-left: 0px">
        
            <li style=""><a href="https://itsalocke.com/tags/auto-deploying-r-documentation">auto deploying r documentation</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/best-practices">best practices</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/continuous-integration">continuous integration</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/presentations">presentations</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/productivity">productivity</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/rmarkdown">rmarkdown</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/travis-ci">travis-ci</a></li>
        
    </ul>


        

<p>In this post, I describe the latest iteration of my automatic document production with R. It improves upon the methods used in <a href="https://github.com/stephlocke/Rtraining">Rtraining</a>, and previous work on this topic can read by going to the <a href="https://itsalocke.com/tag/auto-deploying-r-documentation/">auto deploying R documentation</a> tag.</p>

<p>I keep banging on about this area because reproducible research / analytical document pipelines is an area I&#8217;ve a keen interest in. I see it as a core part of <a href="https://itsalocke.com/dataops-its-a-thing-honest/">DataOps</a> as it&#8217;s vital for helping us ensure our models and analysis are correct in data science and boosting our productivity.</p>

<p>Even after (or because of) a few years of off and on again development to the process, Rtraining had a number of issues:</p>

<ul>
<li>build time was long because all presentations and their respective dependencies were required</li>
<li>if a single presentation broke, any later presentations would not get generated</li>
<li>the presentation build step was in &#8220;after_success&#8221; so didn&#8217;t trigger notifications</li>
<li>the build script for the presentations did a lot of stuff I thought could be removed</li>
<li>the dynamic <a href="https://stephlocke.info/Rtraining/">index page</a> sucks</li>
</ul>

<p>This post covers how I&#8217;m attempting to fix all bar the last problem (more on that in a later post).</p>

<p>With the problems outlined, let&#8217;s look at my new <a href="https://github.com/lockedata/pres-stub">base solution</a> and how it addresses these issues.</p>

<h2 id="structure">Structure</h2>

<p>I have built a template that can be used to generate multiple presentations and publish them to a <code>docs/</code> directory for online hosting by GitHub. I can now use this template to produce category repositories, based on the folders in <code>inst/slides/</code> in Rtraining. I can always split them out further at a later date.</p>

<p>The new repo is structured like so:</p>

<ul>
<li>Package infrastructure

<ul>
<li><code>DESCRIPTION</code> &#8211; used for managing dependencies primarily</li>
<li><code>R/</code> &#8211; store any utility functions</li>
<li><code>.Rbuildignore</code> &#8211; avoid non-package stuff getting checked</li>
</ul></li>
<li>Presentations

<ul>
<li><code>pres/</code> &#8211; directory for storing presentation .Rmd files</li>
<li><code>pres/_output.yml</code> &#8211; file with render preferences</li>
</ul></li>
<li>Output directory

<ul>
<li><code>docs/</code> &#8211; directory for putting generated slides in</li>
</ul></li>
<li>Document generation infrastructure

<ul>
<li><code>.travis.yml</code> &#8211; used to generate documents every time we push a commit</li>
<li><code>buildpres.sh</code> &#8211; shell script doing the git workflow and calling R</li>
<li><code>buildpres.R</code> &#8211; R script that performs the render step</li>
</ul></li>
</ul>

<h2 id="presentations">Presentations</h2>

<ul>
<li>My Rtraining repo contained all presentations in the <code>inst/slidedecks/</code> directory with further categories. This meant that if someone installed Rtraining, they&#8217;d get all the decks. I think this is a sub-optimal experience for people, especially because it mean installing so many packages, and I&#8217;ll be focusing instead on improving the web delivery.</li>
<li>Render requirements are now stored in an <code>_output.yml</code> file instead of being hard coded into the render step so that I can add more variant later</li>
<li>I&#8217;m currently using a modified version of the <a href="https://cran.r-project.org/package=revealjs"><code>revealjs</code></a> package as I&#8217;ve built a heavily customised theme. As I&#8217;m not planning on any of these presentation packages ever going on CRAN, I can use the <code>Remotes</code> field in <code>DESCRIPTION</code> to describe the location. This simplifies the code significantly.</li>
</ul>

<h2 id="document-generation-figure-id-attachment-62216-style-width-485px-class-wp-caption-aligncenter">Document generation<figure id="attachment_62216" style="width: 485px" class="wp-caption aligncenter"></h2>

<p><img src="../img/processflow_ho0b1d.png" alt="Automatic document generation with R" width="485" height="534" class="size-full wp-image-62216" /><figcaption class="wp-caption-text">Automatic document generation with R</figcaption></figure></p>

<h3 id="travis">Travis</h3>

<p>I use <a href="https://travis-ci.org">travis-ci</a> to perform the presentation builds. The instructions I provide travis are:</p>

<pre><code>[embedGitHubContent owner=&quot;lockedata&quot; repo=&quot;pres-stub&quot; path=&quot;.travis.yml&quot;]
</code></pre>

<p>One important thing to note here is that I used some arguments on my package build and check steps along with <code>latex: false</code> to drastically reduce the build time as I have no intention of producing PDFs normally.</p>

<p>The <code>install</code> section is the prep work, and then the <code>script</code> section does the important bit. Now if there are errors, I&#8217;ll get notified!</p>

<h3 id="bash">Bash</h3>

<p>The script that gets executed in my Travis build:</p>

<ul>
<li>changes over to a GITHUB_PAT based connection to the repo to facilitate pushing changes and does some other config</li>
<li>executes the R render step</li>
<li>puts the R execution log in <code>docs/</code> for debugging</li>
<li>commits all the changes using the important prefix <code>[CI SKIP]</code> so we don&#8217;t get infinite build loops</li>

<li><p>pushes the changes</p>

<p>[embedGitHubContent owner=&ldquo;lockedata&rdquo; repo=&ldquo;pres-stub&rdquo; path=&ldquo;buildpres.sh&rdquo;]</p></li>
</ul>

<h3 id="r">R</h3>

<p>The R step is now very minimal in that it works out what presentations to generate, then loops through them and builds each one according to the options specified in <code>_output.yml</code></p>

<pre><code>[embedGitHubContent owner=&quot;lockedata&quot; repo=&quot;pres-stub&quot; path=&quot;buildpres.R&quot;]
</code></pre>

<h2 id="next-steps-for-me">Next steps for me</h2>

<p>This work has substantially mitigated most of the issues I had with my previous Rtraining workflow. I now have to get all my slide decks building under this new process.</p>

<p>I will be writing about making an improved presentation portal and how to build and maintain your own substantially modified revealjs theme at a later date.</p>

<p>The modified workflow and scripts also have implications on my <a href="https://github.com/lockedata/pRojects">pRojects</a> package that I&#8217;m currently developing along with <a href="https://twitter.com/jonmcalder">Jon Calder</a>. I&#8217;d be very interested to hear from you if you have thoughts on how to make things more streamlined.</p>

		</div>
		
</div>
    <div class="row">
    <div class="col-md-12 card">
        <h5>Search</h5>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
            <div class="input-group">
                <input class="form-control" type="search" name="q" />
                <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-search"></span></button>
                </span>
            </div>
            <input type="hidden" name="q" value="site:https://itsalocke.com/blog/">
        </form>
    </div>
</div>

<div class="row">
		  <div class="col-md-12 content-card">
        
    <ul class="list-inline share" style="margin-top: 15px; margin-left: 0px">
        <li class="facebook-share"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fitsalocke.com%2fblog%2fimproving-automatic-document-production-with-r%2f"><i class="fa fa-facebook fa-lg"></i>Facebook</a></li>
        <li class="googleplus-share"><a target="_blank" href="https://plus.google.com/share?url=https%3a%2f%2fitsalocke.com%2fblog%2fimproving-automatic-document-production-with-r%2f"><i class="fa fa-google-plus fa-lg"></i>Google+</a></li>
        <li class="twitter-share"><a target="_blank" href="https://twitter.com/share?url=https%3a%2f%2fitsalocke.com%2fblog%2fimproving-automatic-document-production-with-r%2f&amp;text=Improving%20automatic%20document%20production%20with%20R"><i class="fa fa-twitter fa-lg"></i>Twitter</a></li>
        <li class="reddit-share"><a target="_blank" href="http://reddit.com/submit?url=https%3a%2f%2fitsalocke.com%2fblog%2fimproving-automatic-document-production-with-r%2f&amp;title=Improving%20automatic%20document%20production%20with%20R"><i class="fa fa-reddit fa-lg"></i>Reddit</a></li>
        <li class="linkedin-share"><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fitsalocke.com%2fblog%2fimproving-automatic-document-production-with-r%2f"><i class="fa fa-linkedin fa-lg"></i>LinkedIn</a></li>
        <li class="stumbleupon-share"><a target="_blank" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fitsalocke.com%2fblog%2fimproving-automatic-document-production-with-r%2f&amp;title=Improving%20automatic%20document%20production%20with%20R"><i class="fa fa-stumbleupon fa-lg"></i>StumbleUpon</a></li>
    </ul>


    </div>
	</div>

                    
    
        <div class="row">
            <div class="col-md-12 content-card">
                <div id="disqus_thread"></div>
                <script>
                    (function() {
                        if (window.location.hostname == "localhost") {
                            document.write("Disqus comments are unavailable while serving on localhost or 127.0.0.1");
                            return;
                        }
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        var disqus_shortname = 'itsalocke';
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </div>
    


            </div>
        </div>
        <!-- Footer section -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <span class="copyright">
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
        </span>
      </div>
      <div class="col-md-4">
        <ul class="list-inline social-buttons">
          
            <li>
              <a href="https://twitter.com/lockedata"><i class='fa fa-twitter'></i></a>
            </li>
          
            <li>
              <a href="https://facebook.com/lockedata"><i class='fa fa-facebook'></i></a>
            </li>
          
            <li>
              <a href="https://linkedin.com/company/locke-data"><i class='fa fa-linkedin'></i></a>
            </li>
          
            <li>
              <a href="https://github.com/lockedata"><i class='fa fa-github'></i></a>
            </li>
          
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="list-inline quicklinks">
          
            <li>
              <a href="/blog/index.xml">RSS</a>
            </li>
          
            <li>
              <a href="https://itsalocke.com/company/policies">Legalese and stuff</a>
            </li>
          
            <li>
              <a href="https://goo.gl/forms/KQiYR201Fcn4k9Zh2">Bug Bounty</a>
            </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>

        <div id="back-to-top" class="hidden">
    <a href="#top" class="well well-sm" onclick="$('html,body').animate({scrollTop:0},'slow');return false;">
        <i class="glyphicon glyphicon-chevron-up"></i> Back to Top
    </a>
</div>
<script src="https://itsalocke.com/blog/js/jquery.min.js"></script>
<script src="https://itsalocke.com/blog/js/bootstrap.min.js"></script>
<script src="https://itsalocke.com/blog/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
    if(($(window).height() + 100) < $(document).height()) {
        $('#back-to-top').removeClass('hidden').affix({
            offset: {
                top: 100
            }
        });
    }
</script>

    
        <script>
            
            [].forEach.call(document.querySelectorAll('.adsbygoogle'), function() {
                (adsbygoogle = window.adsbygoogle || []).push({});
            });
        </script>
    


    
 
 
 <script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-58415537-1', 'auto');


ga('require', 'eventTracker');
ga('require', 'outboundLinkTracker');
ga('require', 'urlChangeTracker');
ga('require', 'cleanUrlTracker');
ga('require', 'impressionTracker');
ga('require', 'maxScrollTracker');
ga('require', 'pageVisibilityTracker');


ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<script async src="js/autotrack.js"></script>




    </body>
</html>
