<!DOCTYPE html>
<html lang="en-gb">
    <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.31.1" />
    <title>Building an R training environment</title>
    
    
    
	  <meta property="og:title" content="Building an R training environment" />
<meta property="og:description" content="I recently delivered a day of training at SQLBits and I really upped my game in terms of infrastructure for it. The resultant solution was super smooth and mitigated all the install issues and preparation for attendees. This meant we got to spend the whole day doing R, instead of troubleshooting.
I&#8217;m so happy with the solution for an online R training environment that I want to share the solution, so you can take it and use it for when you need to do training." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itsalocke.com/blog/building-an-r-training-environment/" />



<meta property="article:published_time" content="2017-04-24T08:17:13&#43;00:00"/>

<meta property="article:modified_time" content="2017-04-24T08:17:13&#43;00:00"/>













<meta itemprop="name" content="Building an R training environment">
<meta itemprop="description" content="I recently delivered a day of training at SQLBits and I really upped my game in terms of infrastructure for it. The resultant solution was super smooth and mitigated all the install issues and preparation for attendees. This meant we got to spend the whole day doing R, instead of troubleshooting.
I&#8217;m so happy with the solution for an online R training environment that I want to share the solution, so you can take it and use it for when you need to do training.">


<meta itemprop="datePublished" content="2017-04-24T08:17:13&#43;00:00" />
<meta itemprop="dateModified" content="2017-04-24T08:17:13&#43;00:00" />
<meta itemprop="wordCount" content="746">



<meta itemprop="keywords" content="bash,docker,magick,rocker,rstudio,training," />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Building an R training environment"/>
<meta name="twitter:description" content="I recently delivered a day of training at SQLBits and I really upped my game in terms of infrastructure for it. The resultant solution was super smooth and mitigated all the install issues and preparation for attendees. This meant we got to spend the whole day doing R, instead of troubleshooting.
I&#8217;m so happy with the solution for an online R training environment that I want to share the solution, so you can take it and use it for when you need to do training."/>
<meta name="twitter:site" content="@lockedata"/>

    <meta name="description" content="Locke Data helps organisations get started with data science. Grow your skills with our blog posts." />
    <meta name="keywords" content='bash,docker,magick,rocker,rstudio,training' />
    
        <meta name="author" content="Steph" />
    
    
	
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/highlightjs-themes/androidstudio.css" />
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://itsalocke.com/blog/css/lockedata.css" />
    
        
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({
                    google_ad_client: "ca-pub-XXXXXX",
                    enable_page_level_ads: true
                });
            </script>
        
    
</head>

    <body>
        <!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">

    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand page-scroll" href="/blog/#page-top">
          
          <img src="https://itsalocke.com/blog/img/LockeDataTextNew.svg" class="img-responsive" alt="">
        </a>
      

    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li class="hidden">
          <a href="/blog/#page-top"></a>
        </li>
        
          <li>
            <a href="https://itsalocke.com">Locke Data</a>
          </li>
        
          <li>
            <a href="https://itsalocke.com/blog/">Blog</a>
          </li>
        

        
        
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container-fluid -->
</nav>

        <div id="top" class="container">
            <div class="row" id="content-main">
                    <div class="row">
    <div class="col-md-12 content-card">
        <h1>Building an R training environment</h1>
        
            
            <ul class="list-inline meta">
                <li><i class="fa fa-calendar"></i>April 24, 2017</li>
                <li><i class="fa fa-user"></i>Steph</li>
                
                    
                    <li><i class="fa fa-folder"></i><a href="https://itsalocke.com/categories/dataops">DataOps</a>, <a href="https://itsalocke.com/categories/misc-technology">Misc Technology</a>, <a href="https://itsalocke.com/categories/r">R</a></li>
                
            </ul>
        
        
    <ul class="list-inline tags" style="margin-top: 15px; margin-left: 0px">
        
            <li style=""><a href="https://itsalocke.com/tags/bash">bash</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/docker">docker</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/magick">magick</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/rocker">rocker</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/rstudio">rstudio</a></li>
        
            <li style=""><a href="https://itsalocke.com/tags/training">training</a></li>
        
    </ul>


        

<p>I recently delivered a day of training at <a href="http://sqlbits.com">SQLBits</a> and I really upped my game in terms of infrastructure for it. The resultant solution was super smooth and mitigated all the install issues and preparation for attendees. This meant we got to spend the whole day doing R, instead of troubleshooting.</p>

<p>I&#8217;m so happy with the solution for an online R training environment that I want to share the solution, so you can take it and use it for when you need to do training.</p>

<h2 id="tl-dr-figure-id-attachment-62106-style-width-750px-class-wp-caption-aligncenter">TL;DR<figure id="attachment_62106" style="width: 750px" class="wp-caption aligncenter"></h2>

<p><img src="../img/Workflow_cat6ai.jpg" alt="Workflow for constructing a training environment with RStudio" width="750" height="500" class="size-large wp-image-62106" /><figcaption class="wp-caption-text">Workflow for constructing a training environment with RStudio</figcaption></figure></p>

<p>To get a web-facing Rstudio server, with login details for users, and all the prerequisites installed:</p>

<ol>
<li>Generate usernames and passwords</li>
<li>Build a Docker image based on rocker that contains your users and any prerequisites</li>
<li>Run docker image on VM with a port binding to make the Rstudio accessible externally</li>
</ol>

<h2 id="where-the-magick-happens">Where the <code>magick</code> happens</h2>

<p>The first thing I wanted was user names and passwords for people. I wanted these preprepared and, ideally, on something with my contact info. I&#8217;d used <a href="https://www.moo.com/">moo</a> before so I knew I could do up to 100 custom cards &#8211; I just needed to make them. I used the package <a href="https://cran.r-project.org/package=random"><code>random</code></a> and the package <a href="https://cran.r-project.org/package=magick"><code>magick</code></a> to generate credentials and write them on to PDFs that could then be uploaded to moo.</p>

<p>You can read the whole <a href="https://gist.github.com/stephlocke/32185d02371f29a9ae897aadd28fc1f9">gist</a> but the key code includes:</p>

<ul>
<li><p>A random password generation step</p>

<p>write.csv(data.frame(usernames=paste0(&ldquo;u&rdquo;,stringr::str_pad(1:n,pad = &ldquo;0&rdquo;,width = 3))
                     ,pwords=random::randomStrings(n,len = 6,digits = FALSE,loweralpha = FALSE))
          ,&ldquo;users100.csv&rdquo;,row.names = FALSE)</p></li>

<li><p>A read of my blank card back</p></li>
</ul>

<pre><code class="r">myimage &lt;- magick::image_read(myfile,density = 500)
</code></pre>

<ul>
<li><p>In a loop (there&#8217;s probably a better way!)</p>

<ul>
<li>Writing out the text to the card back</li>
<li>Save a new card back</li>
</ul>

<p>myimage2 &lt;- magick::image_annotate(  myimage, &ldquo;lockedata.biz&rdquo;, font = &ldquo;Roboto&rdquo;, size = 90, location = &ldquo;+350+75&rdquo; )
magick::image_write(myimage2, paste0(&ldquo;GeneratedBacks/&rdquo;,basename, up[i,&ldquo;usernames&rdquo;], &ldquo;.&rdquo;, baseext))</p></li>
</ul>

<h2 id="making-users">Making users</h2>

<p>The next, and much more tricksy, bit was writing a script that would correctly create users. <a href="https://twitter.com/shawty_ds">Peter Shaw</a> helped me out initially and the code looks like:</p>

<pre><code>for userdetails in `cat users.csv`
do
        user=`echo $userdetails | cut -f 1 -d ,`
    passwd=`echo $userdetails | cut -f 2 -d ,`
        useradd $user -m -p `mkpasswd $passwd`
done
</code></pre>

<p>This goes through each line in the CSV and adds a user with a specified password. We use the <code>mkpasswd</code> utility here to encrypt the password. <code>mkpasswd</code> is part of the <code>whois</code> program and we&#8217;ll need that tidbit later.</p>

<p>This needs to be done not only to give people login info but a home directory to save their stuff into. If they don&#8217;t have home directories then Rstudio throws a tantrum with them.</p>

<h2 id="rocker">rocker</h2>

<p>The next bit was getting some sort of server with Rstudio installed. <a href="https://github.com/eddelbuettel">Dirk Eddelbuettel</a> made a bunch of Docker containers available under the <a href="https://github.com/rocker-org/"><code>rocker</code></a> brand. One of these has <a href="https://www.rstudio.com/products/rstudio/download-server/">Rstudio server</a> and the [<code>tidyverse</code>]() installed. Using this preconfigured container would mean I&#8217;d only have to add my finishing touches to it to get everything I needed.</p>

<h2 id="dockerfile">Dockerfile</h2>

<p>The last but one step was building my own customised Docker container that used rocker as a base, created all my users, and installed anything extra I wanted on top of the tidyverse.</p>

<pre><code>FROM rocker/tidyverse
MAINTAINER Steph Locke &lt;steph@itsalocke.com&gt;
RUN apt-get install libudunits2-0 libudunits2-dev whois
RUN  R -e 'devtools::install_github(&quot;lockedata/TextAnalysis&quot;)' 
RUN  R -e 'devtools::install_github(&quot;dgrtwo/widyr&quot;)' 
ADD https://gist.githubusercontent.com/stephlocke/0036331e7a3338e965149833e92c1360/raw/607fb01602e143671c83216a4c5f1ad2deb10bf6/mkusers.sh /
ADD https://gist.githubusercontent.com/stephlocke/0036331e7a3338e965149833e92c1360/raw/6d967c19d9c73cecd1e2d4da0eed2cd646790bd5/users.csv /
RUN chmod 777 /mkusers.sh
RUN /mkusers.sh
</code></pre>

<p>This starts with the tidyverse &amp; Rstudio then:</p>

<ul>
<li>adds the requisite programs for dependencies in my package and <code>whois</code> for <code>mkpasswd</code> to be able to work</li>
<li>installs packages from github, notably the one designed to facilitate the day of text analysis</li>
<li>get the shell script and the csv from the gist</li>
<li>make the shell script executable and then run it</li>
</ul>

<h2 id="c-8217-est-fini">C&#8217;est fini!</h2>

<p>The final step was to actually this container on a Digital Ocean virtual machine (but it could be run anywhere) like so:</p>

<pre><code class="bash">docker pull stephlocke/montypythonwkrshopdocker 
docker run -d -p 80:8787 stephlocke/montypythonwkrshopdocker
</code></pre>

<p>You can take my <a href="https://github.com/stephlocke/montypythonwkrshopdocker">github repo</a> with the Dockerfile and customise it to suit your own requirements, build it in Docker and then use it whenever you need an R training environment that can be customised to your needs and is accessible from a web browser.</p>

<p>You can use it for general working environments but make sure to read my <a href="https://itsalocke.com/talking-data-and-docker/">data persistence in Docker</a> post first as the <code>run</code> command does not have an external volume mapped and if your host for docker crashes, everything will be lost permanently. An extra incentive to use source control maybe!</p>

		</div>
		
</div>
    <div class="row">
    <div class="col-md-12 card">
        <h5>Search</h5>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
            <div class="input-group">
                <input class="form-control" type="search" name="q" />
                <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-search"></span></button>
                </span>
            </div>
            <input type="hidden" name="q" value="site:https://itsalocke.com/blog/">
        </form>
    </div>
</div>

<div class="row">
		  <div class="col-md-12 content-card">
        
    <ul class="list-inline share" style="margin-top: 15px; margin-left: 0px">
        <li class="facebook-share"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fitsalocke.com%2fblog%2fbuilding-an-r-training-environment%2f"><i class="fa fa-facebook fa-lg"></i>Facebook</a></li>
        <li class="googleplus-share"><a target="_blank" href="https://plus.google.com/share?url=https%3a%2f%2fitsalocke.com%2fblog%2fbuilding-an-r-training-environment%2f"><i class="fa fa-google-plus fa-lg"></i>Google+</a></li>
        <li class="twitter-share"><a target="_blank" href="https://twitter.com/share?url=https%3a%2f%2fitsalocke.com%2fblog%2fbuilding-an-r-training-environment%2f&amp;text=Building%20an%20R%20training%20environment"><i class="fa fa-twitter fa-lg"></i>Twitter</a></li>
        <li class="reddit-share"><a target="_blank" href="http://reddit.com/submit?url=https%3a%2f%2fitsalocke.com%2fblog%2fbuilding-an-r-training-environment%2f&amp;title=Building%20an%20R%20training%20environment"><i class="fa fa-reddit fa-lg"></i>Reddit</a></li>
        <li class="linkedin-share"><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fitsalocke.com%2fblog%2fbuilding-an-r-training-environment%2f"><i class="fa fa-linkedin fa-lg"></i>LinkedIn</a></li>
        <li class="stumbleupon-share"><a target="_blank" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fitsalocke.com%2fblog%2fbuilding-an-r-training-environment%2f&amp;title=Building%20an%20R%20training%20environment"><i class="fa fa-stumbleupon fa-lg"></i>StumbleUpon</a></li>
    </ul>


    </div>
	</div>

                    
    
        <div class="row">
            <div class="col-md-12 content-card">
                <div id="disqus_thread"></div>
                <script>
                    (function() {
                        if (window.location.hostname == "localhost") {
                            document.write("Disqus comments are unavailable while serving on localhost or 127.0.0.1");
                            return;
                        }
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        var disqus_shortname = 'itsalocke';
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </div>
    


            </div>
        </div>
        <!-- Footer section -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <span class="copyright">
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
        </span>
      </div>
      <div class="col-md-4">
        <ul class="list-inline social-buttons">
          
            <li>
              <a href="https://twitter.com/lockedata"><i class='fa fa-twitter'></i></a>
            </li>
          
            <li>
              <a href="https://facebook.com/lockedata"><i class='fa fa-facebook'></i></a>
            </li>
          
            <li>
              <a href="https://linkedin.com/company/locke-data"><i class='fa fa-linkedin'></i></a>
            </li>
          
            <li>
              <a href="https://github.com/lockedata"><i class='fa fa-github'></i></a>
            </li>
          
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="list-inline quicklinks">
          
            <li>
              <a href="/blog/index.xml">RSS</a>
            </li>
          
            <li>
              <a href="https://itsalocke.com/company/policies">Legalese and stuff</a>
            </li>
          
            <li>
              <a href="https://goo.gl/forms/KQiYR201Fcn4k9Zh2">Bug Bounty</a>
            </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>

        <div id="back-to-top" class="hidden">
    <a href="#top" class="well well-sm" onclick="$('html,body').animate({scrollTop:0},'slow');return false;">
        <i class="glyphicon glyphicon-chevron-up"></i> Back to Top
    </a>
</div>
<script src="https://itsalocke.com/blog/js/jquery.min.js"></script>
<script src="https://itsalocke.com/blog/js/bootstrap.min.js"></script>
<script src="https://itsalocke.com/blog/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
    if(($(window).height() + 100) < $(document).height()) {
        $('#back-to-top').removeClass('hidden').affix({
            offset: {
                top: 100
            }
        });
    }
</script>

    
        <script>
            
            [].forEach.call(document.querySelectorAll('.adsbygoogle'), function() {
                (adsbygoogle = window.adsbygoogle || []).push({});
            });
        </script>
    


    
 
 
 <script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-58415537-1', 'auto');


ga('require', 'eventTracker');
ga('require', 'outboundLinkTracker');
ga('require', 'urlChangeTracker');
ga('require', 'cleanUrlTracker');
ga('require', 'impressionTracker');
ga('require', 'maxScrollTracker');
ga('require', 'pageVisibilityTracker');


ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<script async src="js/autotrack.js"></script>




    </body>
</html>
